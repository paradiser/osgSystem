# 使用docker完成项目的可行性分析

### 可行，具体细节如下


## 需求

1. 采用C-S 架构
2. 业务流：
	* 客户端完成一套程序
	* 将程序发到服务器
	* 服务器在虚拟环境中运行，并把计算结果(包括图像/文本)返回给客户端
	* 客户端接受数据， 并且进行文本显示(命令行)，图像显示(gui窗口).

------- 

## 解决方案

1. 主要技术 中标麒麟/u麒麟/docker/ssh/qt
2. 程序模块
	* 客户端图形程序
		** 运行在u麒麟操作系统中
		** 包含一个图形程序
		** 图形主界面 / 使用qt
		** 参数设置模块， 用于设置相关的参数， 包括不限于程序类型(文本或gui程序)/管理服务器地址 
		** 文件传输模块， 用于把文件上传到服务端 /利用socket或者远程复制命令scp
		** 远程连接模块， 根据管理节点所分配的服务器地址进行远程连接，使用ssh协议 注意开启x11转发 
	* 管理节点
		** 任意一种服务器操作系统
		** 只有
		** 请求监听与回复 socket
		** 只有一个命令行程序即可
		** 服务器集群和客户端 分配管理模块 
	* 服务端模块
		** 运行在中标麒麟操作系统
		** 监听远程连接 openssh-server； 
		** 图形界面运行环境，开启X11；
		** 程序编译模块 可使用shell script执行g++等命令
		** docker容器， 用于执行客户端传过来的程序
3. 流程：
	客户端打开图形程序 -> 点击"获取服务器"按钮 -> 向管理节点发送socket连接，并获取一个空闲的服务器(包括地址和权限认证信息) -> 把文件传到服务器上->
	->客户端向服务器发送执行程序的指令 (1. 建立远程连接， 2. 执行带参数的docker命令 )
	-> 服务端创建一个docker镜像并且打开一个容器， 运行对应程序
	-> 服务端通过远程连接把运行结果返回给服务端(包括声音和图像)
	-> 客户端关闭程序，保存结果
	-> 服务端确认程序执行完毕， 保存现场， commit镜像 (难点， 实现思路暂味想好)
	-> 关闭远程连接
	-> 向管理节点发送消息， 标记对应服务器为空闲， 并且建立程序运行记录，以待下次连接

4. 几点说明
	* 远程在docker中运行图形程序。这个问题可以解决， 需要指定一系列参数， 这些参数会在其他细节文档中进行说明
	* 客户端是否与某一服务器进行绑定？ 以保证下次程序运行的时候可以使用上次的结果？
	* qt界面说起来比较容易，但是开发起来还是比较麻烦，另一方面参与项目的几位暂时没有相关经验，这可能花费较多时间 
	* 由于在客户使用的环境中无法连接互联网，故服务端docker的安装需要使用源码编译安装，有待实践，可能会出现依赖问题
	* 同样，由于无法连接互联网，所以docker在运行某种程序时无法使用镜像源安装依赖程序，故需要事先了解客户大概会执行哪些程序 \
	  事先把镜像做好， 这样会占用大量的硬盘空间，这是一个有待继续考察的问题。



	























			
